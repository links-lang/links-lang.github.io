<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rev="made" href="mailto:root@yosemite.internal.macports.net" />
</head>

<body>

  <style type="text/css">
    pre {
	overflow: auto;
    }
  </style>

<ul id="index">
  <li><a href="#Links-Syntax">Links Syntax</a>
    <ul>
      <li><a href="#Comments">Comments</a></li>
      <li><a href="#Literals">Literals</a></li>
      <li><a href="#Arithmetic">Arithmetic</a></li>
      <li><a href="#Lists">Lists</a></li>
      <li><a href="#Pattern-matching-on-lists">Pattern matching on lists</a></li>
      <li><a href="#Integer-Ranges">Integer Ranges</a></li>
      <li><a href="#Pairs-Tuples-and-Records">Pairs, Tuples, and Records</a>
        <ul>
          <li><a href="#Record-modifications">Record modifications</a></li>
        </ul>
      </li>
      <li><a href="#Polymorphic-variants">Polymorphic variants</a></li>
      <li><a href="#XML-Quasiquotes">XML Quasiquotes</a></li>
      <li><a href="#Forms">Forms</a></li>
      <li><a href="#Comparisons-and-Boolean-Expressions">Comparisons and Boolean Expressions</a></li>
      <li><a href="#Conditionals">Conditionals</a></li>
      <li><a href="#Variables">Variables</a></li>
      <li><a href="#Blocks">Blocks</a></li>
      <li><a href="#Functions">Functions</a></li>
      <li><a href="#Loops-List-Comprehensions">Loops (List Comprehensions)</a>
        <ul>
          <li><a href="#Filtering-comprehensions">Filtering comprehensions</a></li>
          <li><a href="#Sorting-comprehensions">Sorting comprehensions</a></li>
          <li><a href="#Multi-generator-comprehensions">Multi-generator comprehensions</a></li>
        </ul>
      </li>
      <li><a href="#Database-access">Database access</a>
        <ul>
          <li><a href="#Using-tables">Using tables</a></li>
          <li><a href="#Database-modifications">Database modifications</a></li>
          <li><a href="#Table-constraints">Table constraints</a></li>
          <li><a href="#Database-abstraction">Database abstraction</a></li>
          <li><a href="#Query-blocks">Query blocks</a></li>
        </ul>
      </li>
      <li><a href="#Structural-pattern-matching">Structural pattern matching</a></li>
      <li><a href="#Regular-expressions">Regular expressions</a>
        <ul>
          <li><a href="#Special-feature:-regexes-and-the-database">Special feature: regexes and the database</a></li>
          <li><a href="#Limitations">Limitations</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#Typing">Typing</a>
    <ul>
      <li><a href="#Types-in-Links">Types in Links</a></li>
      <li><a href="#Base-types">Base types</a></li>
      <li><a href="#Type-annotations">Type annotations</a></li>
      <li><a href="#Type-aliases">Type aliases</a></li>
      <li><a href="#Type-variables">Type variables</a></li>
      <li><a href="#Function-types-and-effects">Function types and effects</a></li>
      <li><a href="#Kinds-and-subkinding">Kinds and subkinding</a></li>
    </ul>
  </li>
  <li><a href="#Features">Features</a>
    <ul>
      <li><a href="#Formlets">Formlets</a></li>
      <li><a href="#Concurrency">Concurrency</a></li>
      <li><a href="#Located-code-and-remote-procedure-calls">Located code and remote procedure calls</a></li>
      <li><a href="#Handling-User-Actions">Handling User Actions</a>
        <ul>
          <li><a href="#Interpreting-the-Event">Interpreting the Event</a></li>
        </ul>
      </li>
      <li><a href="#Modifying-the-Web-Page">Modifying the Web Page</a>
        <ul>
          <li><a href="#DOM-operations">DOM operations</a></li>
        </ul>
      </li>
      <li><a href="#XML-operations">XML operations</a></li>
      <li><a href="#Cookies">Cookies</a></li>
    </ul>
  </li>
  <li><a href="#Library-functions">Library functions</a>
    <ul>
      <li><a href="#Explicit-type-conversions">Explicit type conversions</a></li>
      <li><a href="#Negation">Negation</a></li>
      <li><a href="#Character-classification">Character classification</a></li>
      <li><a href="#Case-conversion">Case conversion</a></li>
      <li><a href="#Floating-point-functions">Floating point functions</a></li>
      <li><a href="#Miscellaneous">Miscellaneous</a></li>
    </ul>
  </li>
  <li><a href="#Standard-library-prelude">Standard library (prelude)</a>
    <ul>
      <li><a href="#List-utilities">List utilities</a></li>
      <li><a href="#Web-related-features">Web-related features</a></li>
      <li><a href="#Formlet-library">Formlet library</a></li>
    </ul>
  </li>
  <li><a href="#Running-links">Running links</a>
    <ul>
      <li><a href="#The-interactive-shell">The interactive shell</a>
        <ul>
          <li><a href="#Directives">Directives</a></li>
        </ul>
      </li>
      <li><a href="#Configuration-settings">Configuration settings</a></li>
    </ul>
  </li>
</ul>

<h1 id="Links-Syntax">Links Syntax</h1>

<h2 id="Comments">Comments</h2>

<p>Comments are introduced by a hash mark, <code>#</code>, and continue for the rest of the line.</p>

<h2 id="Literals">Literals</h2>

<ul>

<li><p>Integers: <code>2</code>, <code>7</code></p>

</li>
<li><p>Floating point numbers: <code>3.</code>, <code>14.5</code>,</p>

</li>
<li><p>Booleans: <code>true</code>, <code>false</code>.</p>

</li>
<li><p>Strings: <code>&quot;Cappuccino&quot;</code>, <code>&quot;\&quot;I&#39;ve dropped the toothpaste,\&quot; Tom said, crestfallen.&quot;</code>.</p>

</li>
<li><p>Characters: <code>&#39;a&#39;</code>, <code>&#39;9&#39;</code>, <code>&#39;\012&#39;</code>.</p>

</li>
</ul>

<h2 id="Arithmetic">Arithmetic</h2>

<p>Links supports the standard arithmetic operators.</p>

<pre><code> +                : (Int, Int) -&gt; Int
 -                : (Int, Int) -&gt; Int
 *                : (Int, Int) -&gt; Int
 /                : (Int, Int) -&gt; Int
 ^                : (Int, Int) -&gt; Int
 mod              : (Int, Int) -&gt; Int
 *.               : (Float, Float) -&gt; Float
 +.               : (Float, Float) -&gt; Float
 -.               : (Float, Float) -&gt; Float
 /.               : (Float, Float) -&gt; Float
 ^.               : (Float, Float) -&gt; Float</code></pre>

<p>As Links does not yet have any support for overloading, the floating point versions are distinguished using the &quot;.&quot; suffix. The arithmetic operators can be used infix as is or prefix when enclosed in parentheses.</p>

<pre><code>  1+2*3</code></pre>

<p>returns <code>7</code>.</p>

<pre><code>  (*.)(6.0, 7.)</code></pre>

<p>returns <code>42.</code>.</p>

<h2 id="Lists">Lists</h2>

<p>A list is a finite sequence of values, constructed using <code>[]</code> (pronounced &quot;nil&quot;) and <code>::</code> (pronounced &quot;cons&quot;).</p>

<pre><code>   1 :: 4 :: 9 :: 16 :: []</code></pre>

<p>A list can be created directly by wrapping a series of comma-separated expressions between brackets:</p>

<pre><code>    [1, 4, 9, 16]

    [&quot;apple&quot;, &quot;banana&quot;, &quot;pear&quot;]

    []

    x = true;
    [true, false, x, true]</code></pre>

<p>Note that all elements of a list must be of the same type.</p>

<p>Lists support the &quot;concatenate&quot; operation, denoted by two plus characters:</p>

<pre><code>    [1, 2] ++ [3, 4, 5] == [1, 2, 3, 4, 5]</code></pre>

<p>And they&#39;re comparable, with <code>==</code>, as you can see!</p>

<p>The ``Cons&#39;&#39; operator (<code>::</code>) appends an element to the start of a list.</p>

<pre><code>  links&gt; 1::[2,3,4,5];
  [1, 2, 3, 4, 5] : [Int]</code></pre>

<p>The head (<code>hd</code>) and tail (<code>tl</code>) functions each take a single list as an argument. They return respectively: the first element of the list; and the list consisting of all elements but the first from the original list.</p>

<pre><code>  links&gt; hd([1,2,3]);
  1 : Int
  links&gt; tl([1,2,3]);
  [2, 3] : [Int]</code></pre>

<p>The take and drop functions return respectively: the first n elements of a list; and all but the first n elements of a list.</p>

<pre><code>  links&gt; take(2,[1,2,3]);
  [1, 2] : [Int]
  links&gt; drop(2,[1,2,3]);
  [3] : [Int]</code></pre>

<h2 id="Pattern-matching-on-lists">Pattern matching on lists</h2>

<p>Cons and nil can also be used in patterns, to deconstruct lists:</p>

<pre><code>  switch (s) {
    case []    -&gt; Empty
    case x::xs -&gt; NonEmpty
  }</code></pre>

<h2 id="Integer-Ranges">Integer Ranges</h2>

<p>The syntax <code>[a .. b]</code> constructs a list of all the integers between <code>a</code> and <code>b</code>, inclusive. The result is empty if <code>a</code> is greater than <code>b</code>.</p>

<h2 id="Pairs-Tuples-and-Records">Pairs, Tuples, and Records</h2>

<p>A tuple is a finite sequence of values, possibly of different types. An <i>n</i>-tuple is constructed by enclosing <i>n</i> expressions in parenthesis and separating them with commas:</p>

<pre><code>   (a, &quot;OK&quot;)
   (true, &quot;a string&quot;, 42)</code></pre>

<p>A record is something like a tuple, but its fields are indexed by field names rather than integer indices. A record is written like a tuple but with fieldnames preceeding the fields:</p>

<pre><code>  (lastname=&quot;Bond&quot;, firstname=&quot;James&quot;, license=&quot;To kill&quot;)</code></pre>

<p>Field names are not enclosed in quotes and are not expressions. They are not evaluated. Note that, whereas the content of a field can be any expression, the field name must be literally present when constructing a record. For example:</p>

<pre><code>  var item = (drinkname = &quot;latte&quot;, price = 2.0 +. 0.5)          # OK
  var item = (&quot;drink&quot; + &quot;name&quot; = &quot;latte&quot;, price = 2.0 +. 0.5)   # NOT OK</code></pre>

<p>You can access the fields of a record by <i>projecting</i> them, using the dot notation:</p>

<pre><code>  item.drinkname == &quot;latte&quot;
  (lastname=&quot;Bond&quot;, firstname=&quot;James&quot;).lastname == &quot;Bond&quot;</code></pre>

<h3 id="Record-modifications">Record modifications</h3>

<p>You can <i>add</i> a field to an arbitrary record using the <i>record extension</i> operation. This operation works only when the field is not already present in the record. As an example:</p>

<pre><code>  (caffeineContent = 60 | item)</code></pre>

<p>Given the definition from above, this would yield a value</p>

<pre><code>  (caffeineContent = 60, drinkname = &quot;latte&quot;, price = 2.5)</code></pre>

<p>To <i>overwrite</i> the value in a field, when that field is already present, use the &quot;with&quot; notation:</p>

<pre><code>  (item with drinkname = &quot;capuccino&quot;)</code></pre>

<p>This yields</p>

<pre><code>  (drinkname=&quot;capuccino&quot;, price=2.5)</code></pre>

<p>Records do not need to be declared; a given field name can appear in any record. The only requirement is that a given field is used with a consistent type, insofar as the the values may interact. It is acceptable to use a particular field name with different types, as long as the two are used separately--that is, as long as the same value will never be used in differently-typed expressions.</p>

<h2 id="Polymorphic-variants">Polymorphic variants</h2>

<p>A &quot;variant type&quot; is one that uses explicit &quot;tags&quot; (or &quot;labels&quot;) to distinguish different sets of possible values as to their meaning. For example, a mode of transport may be either Automobile or Camel. If it is Automobile, we want to know what fuel it takes; if it is Camel, we want to know how many humps it has. In Links, values like these can be expressed as follows:</p>

<pre><code>  Automobile(Diesel)
  Automobile(Unleaded)
  Camel(2)</code></pre>

<p>The <i>type</i> that includes such values is written as follows:</p>

<pre><code>  [|Automobile: [|Diesel:() | Unleaded:() | Biodiesel:()|] |
    Camel: Int |]</code></pre>

<p>The boxy brackets <code>[| |]</code> delimit a variant type, and variant labels are separated by a pipe <code>|</code>. After each variant label, separated by a colon <code>:</code>, is the type of its contents--a Camel has a number of humps so its content type is <code>Int</code>, whereas the Automobile content type is another variant type, <code>[|Diesel | Unleaded|]</code>.</p>

<p>In Links, <i>a variant tag always begins with a capital letter</i>. Any string beginning with a capital letter, used in a value context, denotes a variant label.</p>

<p>To inspect a variant value, use <i>pattern matching</i>. Pattern matching is accomplished using the <code>switch</code> form, which has a target expression and a case for each variant label. The following expression determines the effective number of humps of a transport (autos have no humps):</p>

<pre><code>  switch (target) {
    case Automobile(fuelType) -&gt; 0
    case Camel(humpCount) -&gt; humpCount
  }</code></pre>

<p>The expression <code>expr</code> is evaluated to produce a value of variant type; then the label is examined and one of the cases is chosen. The lowercase word following the variant label in a case is bound to the content of the target value (provided that case actually matches the target). This allows us to use the variable <code>humpCount</code> within the body of the <code>Camel</code> case. The body of a case (everything between the <code>-&gt;</code> and the next case (if any) or the end of the switch) produces the result of the whole switch expression, and all case bodies of a switch must have the same type.</p>

<p>Type-checking will also ensure that all possible cases are matched by the <code>switch</code> expression. To handle arbitrary variant values, you can add an open case to the end of the switch:</p>

<pre><code>  switch (target) {
    case Automobile(fuelType) -&gt; 0
    case Camel(humpCount) -&gt; humpCount
    case other -&gt; 0
  }</code></pre>

<p>Since <code>other</code> begins with a lowercase letter, it is a variable, which matches any value. Unlike the variables in the previous cases, which are wrapped inside variant labels, <code>other</code> is used here as the complete pattern to match for its case, so it will match anything. Patterns are tried in the order they are given, so the <code>other</code> case will not by selected unless the previous cases do not match.</p>

<p>Here we assume that nothing other than a camel has humps.</p>

<h2 id="XML-Quasiquotes">XML Quasiquotes</h2>

<p>Also called &quot;quasis,&quot; these are the principal way to embed XML values within your program. A quasi is introduced by an XML start-tag such as <code>&lt;foo&gt;</code>. Inside a quasi, you may escape from the XML mode back into Links syntax, by enclosing the Links code within braces { }. When the quasi is evaluated, all its escaped expressions will be evaluated, and their values will be embedded within the constructed XML value. For example:</p>

<pre><code>    &lt;html&gt;
      &lt;ul&gt;
        &lt;li&gt; First item: {item1} &lt;/li&gt;
        &lt;li&gt; Second item: {item2} &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/html&gt;</code></pre>

<p>Within an XML quasi, a variety of special features can be used to handle browser events. See <a href="#Handling-User-Actions">&quot;Handling User Actions&quot;</a>, below, for more information on these features.</p>

<p>To introduce a <i>forest</i> of XML nodes that have no mutually enclosing XML element, use the special <code>&lt;#&gt;...&lt;/#&gt;</code> syntax:</p>

<pre><code>    &lt;#&gt;
      Name: &lt;b&gt;{name}&lt;/b&gt;
    &lt;/#&gt;</code></pre>

<p>Here, a <i>sequence</i> of nodes (first, an XML text node, and then a &lt;b&gt; element) becomes as a single expression. This value can be included directly in other XML quasis:</p>

<pre><code>    var nameLine = &lt;#&gt; Name: &lt;b&gt;{name}&lt;/b&gt; &lt;/#&gt;;
    &lt;div&gt;
      {nameLine} &lt;br /&gt;
      The Links Team
    &lt;/div&gt;</code></pre>

<h2 id="Forms">Forms</h2>

<p>Links provides two special attributes for programming with HTML forms: <code>l:name</code>, which binds the value of an input field to a variable, and <code>l:onsubmit</code>, with which you can supply an expression to be evaluated when the form is submitted.</p>

<pre><code>   &lt;form l:onsubmit=&quot;{say_hello(personName)}&quot;&gt;
      What is your name?
      &lt;input l:name=&quot;{personName}&quot;/&gt;
   &lt;/form&gt;</code></pre>

<p>The <code>personName</code> variable bound by the <code>l:name</code> attribute is in scope in the <code>l:onsubmit</code> expression, which may also contain references to other variables in the enclosing scope. The values of these variables are passed from form to form automatically.</p>

<p>Unfortunately, the <code>l:</code> mechanism does not support any abstraction in building forms. For a more abstraction-friendly construct, see <a href="#Formlets">&quot;Formlets&quot;</a>, describing a mechanism for abstracting form fragments.</p>

<h2 id="Comparisons-and-Boolean-Expressions">Comparisons and Boolean Expressions</h2>

<p>Comparisons are binary operations that yield a true/false value.</p>

<ul>

<li><p>==</p>

<p>True iff the operands evaluate to the same value.</p>

</li>
<li><p>&lt;&gt;</p>

<p>True iff the operands evaluate to different values.</p>

</li>
<li><p>&lt;</p>

<p>True iff the left operand&#39;s value is less than the right operand&#39;s</p>

</li>
<li><p>&gt;</p>

<p>True iff the right operand&#39;s value is less than the left operand&#39;s</p>

</li>
<li><p>&lt;=</p>

<p>True iff the left operand&#39;s value is less than or equal to the right operand&#39;s</p>

</li>
<li><p>&gt;=</p>

<p>True iff the right operand&#39;s value is less than or equal to the left operand&#39;s</p>

</li>
</ul>

<p>Boolean expressions can be combined using the boolean operators:</p>

<ul>

<li><p>&amp;&amp;</p>

</li>
<li><p>||</p>

</li>
<li><p>not</p>

</li>
</ul>

<h2 id="Conditionals">Conditionals</h2>

<p>A conditional expression has a condition, a consequent, and an else clause. None of the three may be omitted.</p>

<pre><code>    if (x == y)
        expr1
    else
        expr2</code></pre>

<p>Curly braces can be wrapped around either clause, no matter how many sub-expressions they contain, and <i>must</i> be so wrapped if you want the clause to consist of more than one semicolon-separated expression.</p>

<p>Note that an <code>if</code>-<code>else</code> expression <i>always</i> returns a value in Links; the return values of the two branches must be of the same type, and both branches are required.</p>

<h2 id="Variables">Variables</h2>

<p>Variables are single-assignment in Links. The form</p>

<pre><code>    var x = expr;
    etc</code></pre>

<p>evaluates <code>expr</code> and binds the name <code>x</code> to the resulting value, within the expression <code>etc</code>.</p>

<p>Variable assignments have block scope. The following example</p>

<pre><code>    var x = 1;
    if (condition) {
      var x = 2
    } else {
      var x = 3
    };
    print int_to_string(x);</code></pre>

<p>prints <code>1</code> because the assignments to <code>x</code> within the if clauses only bind within those clauses. If you want the value printed to depend on the condition, you should assign to <code>x</code> from the result of the whole <code>if</code> expression:</p>

<pre><code>    var x = if (condition) {
      2
    } else {
      3
    };
    print int_to_string(x);</code></pre>

<h2 id="Blocks">Blocks</h2>

<p>A sequence of variable bindings separated by semicolons is evaluated in text order, binding each value to the corresponding name in what follows. Variables cannot be rebound; later bindings of the same name shadow preceding ones:</p>

<pre><code>    var x = 1;
    var y = 2;
    var x = 2;
    var z = x + y;    # z is now bound to 4</code></pre>

<p>The scope of a binding is strictly within its immediate block. As a result, the following code may not do what you expect:</p>

<pre><code>    var x = 0;
    if (a == b)
        var x = 1;
    else
        var x = 2;
    alert(x);</code></pre>

<p>The value printed by <code>alert</code> will be 0. That&#39;s because the other two bindings only bind x within the corresponding clauses of the conditional. This may come as a surprise to programmers used to imperative languages.</p>

<h2 id="Functions">Functions</h2>

<p>Functions can be named or anonymous. Named functions look like this:</p>

<pre><code>    fun foo(x, y, z)
    {
        # ... body
    }</code></pre>

<p>Anonymous functions just omit the name: <code>fun (x) { x + 1 }</code> is an expression that evaluates to an anonymous function value.</p>

<p>Function values, whether named or anonymous, are lexical closures; any variables free in the body must refer to bindings from a surrounding lexical scope. The smallest surrounding scope is chosen.</p>

<p>A function can be called by using its name, followed by a list of arguments in parentheses:</p>

<pre><code>    foo(1, 2, 7)</code></pre>

<p>This works whether <code>foo</code> is a function defined with a name, as <code>fun foo(...) {...}</code>, or a variable bound to a functional value, as</p>

<pre><code>    var inc = fun (x) {x + 1};
    inc(7)</code></pre>

<p>This block returns <code>8</code>.</p>

<p>Any expression that evaluates to a function value can be called:</p>

<pre><code>    (if (true) fun (x) { x + 1 }
     else fun (x) { x + 2 })(3)</code></pre>

<h2 id="Loops-List-Comprehensions">Loops (List Comprehensions)</h2>

<p>The principal loop construct in Links is the list comprehension:</p>

<pre><code>    for (x &lt;- source)
       body</code></pre>

<p>Both the source and the body should be expressions that evaluate to lists.</p>

<p>The value of a comprehension is the concatenation of all the lists produced by evaluating the body, once for each element of <i>source</i>, and binding that element to the variable <code>x</code>. For example:</p>

<pre><code>    var source_list = [1, 2, 3];
    for (x &lt;- source_list)
        [ x*x ]</code></pre>

<p>constructs a list of the squares of the values in <code>source_list</code>. Note that more than one value can be included in the body list:</p>

<pre><code>    var source_list = [2, 3, 7, 8, 9, 55];
    for (n &lt;- source_list)
        if (odd(n))
           [n, n+1]
        else
           [n]</code></pre>

<p>This example returns <code>[2, 3, 4, 7, 8, 8, 9, 10, 55, 56]</code>.</p>

<p>Other forms of looping can be implemented using tail recursion.</p>

<h3 id="Filtering-comprehensions">Filtering comprehensions</h3>

<p>A comprehension can be filtered using the <code>where</code> clause.</p>

<pre><code>    var source = [2, 3, 4, 5, 6, 7];
    for (x &lt;- source)
    where (odd(x))
      [x+1]</code></pre>

<p>returns <code>[4, 6, 8]</code>.</p>

<p>A <code>where</code> clause is equivalent to a condition nested within a comprehension:</p>

<pre><code>    for (x &lt;- src)
    where (pred)
      expr</code></pre>

<p>is equivalent to</p>

<pre><code>    for (x &lt;- src)
      if (pred)
        expr
      else []</code></pre>

<p><code>where</code> is a clause on <code>for</code> comprehensions: it cannot be used outside of a <code>for</code>.</p>

<h3 id="Sorting-comprehensions">Sorting comprehensions</h3>

<p>The <code>orderby</code> clause on <code>for</code> comprehensions is used to sort the source before evaluating the body.</p>

<p>For example, suppose &quot;models&quot; is a list declared previously with type <code>[(release_year:Int,model_number:Int,model_name:String)]</code>, describing models of an automobile make. Then the following will return a list of pairs describing the models, ordered by their year of release:</p>

<pre><code>    for (m &lt;- models)
    orderby (m.release_year)
      [(m.model_number, m.model_name)]</code></pre>

<h3 id="Multi-generator-comprehensions">Multi-generator comprehensions</h3>

<p>A comprehension can draw elements from more than one list. For each element produced by the first <i>generator</i>, Links iterates over all the items produced by the remaining generators.</p>

<p>For example:</p>

<pre><code>   links&gt;
     for (fruit &lt;- [&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;], i &lt;- [1..4])
       [(i, fruit)];
   [(1, &quot;apple&quot;),  (2, &quot;apple&quot;),  (3, &quot;apple&quot;),  (4, &quot;apple&quot;),
    (1, &quot;banana&quot;), (2, &quot;banana&quot;), (3, &quot;banana&quot;), (4, &quot;banana&quot;),
    (1, &quot;orange&quot;), (2, &quot;orange&quot;), (3, &quot;orange&quot;), (4, &quot;orange&quot;)] : [(Int, String)]</code></pre>

<p>You can also impose an order on all the elements produced by the series of generators in a comprehension header, as in:</p>

<pre><code>   links&gt;
     for (fruit &lt;- [&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;], i &lt;- [1..4])
     orderby (fruit)
       [(i, fruit)];
   [(1, &quot;apple&quot;),  (2, &quot;apple&quot;),  (3, &quot;apple&quot;),  (4, &quot;apple&quot;),
    (1, &quot;banana&quot;), (2, &quot;banana&quot;), (3, &quot;banana&quot;), (4, &quot;banana&quot;),
    (1, &quot;orange&quot;), (2, &quot;orange&quot;), (3, &quot;orange&quot;), (4, &quot;orange&quot;)] : [(Int, String)]</code></pre>

<p>Links will produce a list of tuple elements as dictated by the generators, then sort them, and finally evaluate the body expression for each element produced. Note that it is the source elements, <i>not</i> the body elements, which are sorted.</p>

<p>The effect of multi-generator comprehensions is much like that of nested comprehensions: the comprehension</p>

<pre><code>     for (fruit &lt;- [&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;], i &lt;- [1..4])
       [(i, fruit)];</code></pre>

<p>behaves just like this one:</p>

<pre><code>     for (fruit &lt;- [&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;])
       for (i &lt;- [1..4])
         [(i, fruit)];</code></pre>

<p>But multi-generator comprehensions are different from the nested counterparts when it comes to clauses such as <code>orderby</code>. This is because the <code>orderby</code> clause sorts the list of tuples produced by all the generators in the <i>most recent</i> comprehension header. When using nested single-generator comprehesions, you are sorting one series of elements which is then collected by another comprehension, for a result than may not obey the desired ordering. For example,</p>

<pre><code>   links&gt; for (fruit &lt;- [&quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;])
            for (i &lt;- [1..4])
            orderby (i)
              [(i, fruit)];
   [(1, &quot;apple&quot;),  (2, &quot;apple&quot;),  (3, &quot;apple&quot;),  (4, &quot;apple&quot;),
    (1, &quot;banana&quot;), (2, &quot;banana&quot;), (3, &quot;banana&quot;), (4, &quot;banana&quot;),
    (1, &quot;orange&quot;), (2, &quot;orange&quot;), (3, &quot;orange&quot;), (4, &quot;orange&quot;)] : [(Int, String)]</code></pre>

<h2 id="Database-access">Database access</h2>

<p>To access the database, use <i>database</i> and <i>table expressions</i>, which produce first-class values representing, respectively, database connections and tables within such connected databases.</p>

<p>To connect to a given database instance using a particular database driver, use a <code>database</code> expression.</p>

<pre><code>  database &lt;database-name&gt; &lt;driver-name&gt; &lt;parameter-string&gt;;</code></pre>

<p>The <code>&lt;parameter string&gt;</code> is a colon-separated string whose interpretation is driver-dependent, but which usually includes the hostname, port, username and password. For example, to connect to the database <code>ice_cream</code> using the <code>mysql</code> driver, using the default host name and the port 3306, and bind the resulting connection to the variable <code>db</code>, use</p>

<pre><code>  var db = database &quot;ice_cream&quot; &quot;mysql&quot; &quot;:3306:web:&quot;;</code></pre>

<p>The driver and parameter string default to the configuration values <code>database_driver</code> and <code>database_args</code>, so at a minimum you need only give the instance name:</p>

<pre><code>  var db = database &quot;ice_cream&quot;;</code></pre>

<p>Supported drivers include <code>postgres</code>, <code>mysql</code> and <code>sqlite</code>. The <code>&lt;parameter-string&gt;</code> field is presently only used by the postgres and mysql drivers and has the form:</p>

<pre><code>  host:port:user:password</code></pre>

<p>When a database expression is evaluated on the server a connection is automatically opened if one is not already open.</p>

<p>Table-handles are created using <code>table</code> expressions, which need the table&#39;s name, its type, as a record, and the database connection (a value produced by a <code>database</code> expression as above):</p>

<pre><code>  table &lt;table-name&gt; with &lt;row-type&gt; from &lt;database-connection&gt;;</code></pre>

<p>For example, to create a handle to the table <code>ice_cream</code> with fields <code>i</code> and <code>f</code> both of type <code>Int</code> associated with the database <code>db</code>, and bind it to the variable <code>fac_table</code>, use:</p>

<pre><code>  var parlors = table &quot;ice_cream_parlors&quot;
                with (name : String, fans : Int) from db;</code></pre>

<p>The variable <code>parlors</code> then has type <code>TableHandle((name : String, fans : Int), (name : String, fans : Int), (name : String, fans : Int))</code>. The three arguments to the <code>TableHandle</code> type constructor together identify the type of a row and its constraints (See <a href="#Table-constraints">&quot;Table constraints&quot;</a>).</p>

<h3 id="Using-tables">Using tables</h3>

<p>To iterate over the items of a table--or just to fetch one row--use <code>for</code> comprehensions.</p>

<p>Since a table-handle in Links is different from a list, we cannot simply draw elements directly from a table as we draw them from a list. But a special form of generator accepts a table-handle as its source:</p>

<pre><code>  var parlors = table &quot;ice_cream_parlors&quot;
                with (name : String, fans : Int) from db;
  for (p &lt;-- parlors)
  where (p.flavors &gt; 1)
    [x]</code></pre>

<p>This comprehension selects all the elements from the <code>ice_cream_parlors</code> table that serve more than one flavor.</p>

<p>The special <i>long-arrow generator</i> <code>&lt;--</code> accepts a table-handle, and not a list, as its right-hand side.</p>

<p>The long-arrow generator also specifies that the comprehension in which it participates <i>must</i> be executed by a single SQL query at run time. When an expression is executed as a query, it should be relatively efficient because, for example, any comprehension filtering should be performed by the database, before involving the Links runtime system. The database system may be able to do this efficiently by using its indexes.</p>

<p>When you don&#39;t want to specify that an expression becomes a query, you can extract all the rows of a table directly using the special function <code>asList</code>. The <code>asList</code> function takes a single argument, a table handle, and produces a list of all the rows in the table at the time when the function is applied.</p>

<p>For example, you may write</p>

<pre><code>  for (p &lt;-- parlors)
   where (p.flavors &lt;= 20)
    [(name = p.name)]</code></pre>

<p>to extract from the <code>parlors</code> table the names of those with fewer than 20 flavors. This might be compiled into an SQL query such as</p>

<pre><code>  select p.name as name from parlors as p
  where p.flavors &lt;= 20</code></pre>

<p>The <code>asList</code> function extracts an entire table at once:</p>

<pre><code>  sig asList : (TableHandle((|a::Base),_,_)) -&gt; [(|a::Base)]
  fun asList(t) {for (z &lt;-- t) [z]}</code></pre>

<p>Thus the following expression gives the same result as the previous query for selecting shops with fewer than 20 flavors, but it does more work outside the database system:</p>

<pre><code>  for (p &lt;- asList(parlors))
   where (p.flavors &lt;= 20)
    [(name = p.name)]</code></pre>

<p>It would use the following simple SQL to get its raw data:</p>

<pre><code>  select * from parlors</code></pre>

<p>and the Links runtime system would filter the data itself.</p>

<h3 id="Database-modifications">Database modifications</h3>

<p>Links can also modify database tables using insert, update and delete operations, which work similarly to the corresponding SQL statements.</p>

<p>For example, the Links expression</p>

<pre><code>  insert t values (f1, ..., fk) rs</code></pre>

<p>inserts the list of rows <code>rs</code> into the table <code>t</code> where <code>rs</code> must be a list of records with fields <code>f1, ... fk</code>.</p>

<p>The Links expression</p>

<pre><code>  update (var r &lt;-- t)
   where condition
   set (f1 = v1, ..., fn = vn)</code></pre>

<p>updates the rows of table <code>t</code> that satisfy <code>condition</code> by setting each field <code>fi</code> to <code>vi</code>.</p>

<p>The Links expression</p>

<pre><code>  delete (var r &lt;-- t)
   where condition</code></pre>

<p>deletes the rows of table <code>t</code> that satisfy <code>condition</code>.</p>

<h3 id="Table-constraints">Table constraints</h3>

<p>Database fields can be given two kinds of special features: they can be made <i>read-only</i> and they can be <i>defaulted</i> or given default values when inserting.</p>

<p>A read-only field must not be included in an insert or an update. A defaulted field need not, and cannot, be included in an insert or update command.</p>

<p>To enable these special features on a table field, add a <code>where</code> clause to the table expression that lists field names with the corresponding keyword. For example:</p>

<pre><code>  table &quot;people&quot; with (id:Int, name:String, nationality:String)
                 where id readonly, nationality default from db</code></pre>

<p>This returns a table handle for the table <code>people</code> with fields <code>id</code> and <code>nationality</code>, where the <code>id</code> field cannot be modified through this handle, and <code>nationality</code> has a default value so giving a value is optional when modifying the table.</p>

<p>The type assigned by Links to a table handle has three fields, indicating the <i>readable</i> fields, the <i>writeable</i> fields and the <i>needed</i> fields, in that order:</p>

<pre><code>  links&gt;
    var t = table &quot;people&quot; with (id:Int, name:String, nationality:String)
                           where id readonly, nationality default from db;
  t = (table people) :
    TableHandle((id:Int,name:String,nationality:String),
                (name:String,nationality:String),
                (name:String))</code></pre>

<p>Only <code>name</code> and <code>nationality</code> are <i>writeable</i>, as <code>id</code> is read-only. Only <code>name</code> is <i>needed</i> when inserting, as <code>nationality</code> has a default and <code>id</code> is read-only.</p>

<h3 id="Database-abstraction">Database abstraction</h3>

<p>Links supports a powerful mode of abstraction over query fragments.</p>

<p>A simple example occurs when you want to filter a table, but using some abstract predicate given by another piece of code. For example, you are writing an API to access some database tables, and you want the API caller to be able to choose how to filter the rows.</p>

<p>A natural way to do this in Links is to represent the filter using a predicate function (one mapping table rows to booleans):</p>

<pre><code>  fun selectedShops(pred) {
    for (p &lt;-- parlors) where (pred(p)) e
  }</code></pre>

<p>In this situation, since the long-arrow generator is used, the programmer demands that the entire comprehension be executed as a single SQL query--even though the predicate on which to filter is not known until runtime.</p>

<p>Still, Links guarantees at compile time that this is achievable--or gives a compile-time error if not. This involves analyzing the program to ensure that callers of <code>selectedShops</code> never pass a function that Links cannot translate to SQL in the context of the above query. If so, an error is generated, usually at the call site, explaining that the function passed was &quot;wild&quot;--the Links term for a function that doesn&#39;t translate to SQL.</p>

<p>How to determine at a glance whether your function will translate to SQL? In brief, the only sorts of functions that should fail to translate are those that use &quot;wild&quot; primitives, and recursive functions.</p>

<p>To recognize wild and tame functions in the compiler&#39;s output, look at the function arrows. A straight arrow <code>-</code>&gt; indicates a tame function, which can be translated to the database. A squiggly arrow <code>~</code>&gt; indicates a wild function, which cannot be compiled to the database. You can also use these arrow forms in the source, in type annoations, to constrain functions to the way you think they should act (or force the compiler to produce an error message if not).</p>

<p>A comprehension with a long-arrow generator (See <a href="#Using-tables">&quot;Using tables&quot;</a>) implicitly requires the entire comprehension to be translatable to a single SQL query, and this effectively requires every function it calls to be <i>tame</i>. To assert this requirement explicitly, or to make it elsewhere than a comprehension, use the <code>query</code> block form (See <a href="#Query-blocks">&quot;Query blocks&quot;</a>).</p>

<p>Besides the issue of wildness, a query expression is not considered SQL-translatable if its result type is not the type of a flat relation--a list of records with fields of base type (<code>Int</code>, <code>String</code>, <code>Float</code>, and so on).</p>

<h3 id="Query-blocks">Query blocks</h3>

<p>To assert explicitly that an expression--which need not be a comprehension--translates to a query, wrap it in a query block:</p>

<pre><code>  query {
    e
  }</code></pre>

<p>As with long-arrow comprehensions, the expression <code>e</code> must be &quot;tame&quot; and must have relation type: a list of records with fields of base type, or the compiler will give an error.</p>

<p>Use <code>query</code> assertions to offload parts of your computation to the database system, taking advantage of its efficient query-planning facilities.</p>

<h2 id="Structural-pattern-matching">Structural pattern matching</h2>

<p>As well as lists and variants, pattern matching can also be performed on constants.</p>

<pre><code>  switch (name) {
    case &quot;Ezra&quot; -&gt; &quot;Cooper&quot;
    case &quot;Jeremy&quot; -&gt; &quot;Yallop&quot;
    case &quot;Phil&quot; -&gt; &quot;Wadler&quot;
    case &quot;Sam&quot; -&gt; &quot;Lindley&quot;
  }</code></pre>

<p>In common with other strongly-typed functional programming languages such as ML and Haskell, Links supports deep pattern matching.</p>

<pre><code>  fun firstChildId(tree) {
    switch (tree:mu a.[|Node:(a, b, a) | Leaf|]) {
      case Node(Node(_, id, _), _, _) -&gt; Some(id)
      case Node(Leaf, _, Node(_, id, _)) -&gt; Some(id)
      case _ -&gt; None
    }
  }</code></pre>

<p>This function takes a labelled binary tree, and returns the id of the first child of the root, if it exists. The wildcard pattern <code>_</code> matches any value. The type annotation is necessary if you want to constrain the function to only operate on labelled binary trees.</p>

<p>Using <code>switch</code> it is possible to dispatch according to the structure of a value. If the structure of a value is already known, then patterns can also be used in other contexts. Patterns can be used to bind function arguments.</p>

<pre><code>  fun foo((x=a, y=b)) {a+b}
  foo((x=2,y=3))</code></pre>

<p>This example returns <code>5</code>. Patterns can also be used to bind local variables.</p>

<pre><code>  {
    var language = Language(&quot;Links&quot;);
    var Language(name) = language;
    name
  }</code></pre>

<p>This example returns <code>&quot;Links&quot;</code>.</p>

<h2 id="Regular-expressions">Regular expressions</h2>

<p>Rudimentary regular-expression (regex) handling is provided for matching string against regex patterns.</p>

<p>A regular expression is written between slashes, as <code>/this.is.a.regex/</code>.</p>

<p>The operator <code>=~</code> tests the string on its left-hand side against the regular expression on its right-hand side. For example:</p>

<pre><code>    if (&quot;haystack&quot; =~ /ne+dle/)
      print(&quot;Found needle in haystack.&quot;)
    else
      print(&quot;No needle found in haystack.&quot;)</code></pre>

<p>Presently the regex support is somewhat limited; only the following constructions are supported (<code>e</code> standing for any regex):</p>

<pre><code>    a         (an unadorned character) match exactly that character
    [a-z0-9-] match any single character in the given range
    .         match any single characer
    e*        match e zero or more times
    e+        match e one or more times
    e?        match an empty string, or e exactly once.
    (e)       matches whatever e matches</code></pre>

<p>Any of the special characters, <code>*</code> <code>+</code> <code>?</code> <code>(</code> <code>)</code> <code>[</code> and <code>]</code>, can be escaped with a backslash, in which case they match precisely that character, instead of having a special meaning.</p>

<p>Unlike most other regex systems, Links regexes are anchored on both ends. So, to match a substring, you need to add <code>.*</code> at both ends. For example:</p>

<pre><code>    links&gt; &quot;Portobello&quot; =~ /bell/
    false : Bool

    links&gt; &quot;Portobello&quot; =~ /.*bell.*/
    true : Bool</code></pre>

<h3 id="Special-feature:-regexes-and-the-database">Special feature: regexes and the database</h3>

<p>Certain uses of regular expressions can be translated to an SQL expression involving the <code>LIKE</code> operator. For example, the expression</p>

<pre><code>    for (uni &lt;-- universities)
    where (uni.city =~ /.*edinburgh.*/)
      [uni]</code></pre>

<p>should translate to an SQL query that selects all those unis from the <code>universities</code> table having <code>edinburgh</code> as a substring of their <code>name</code> column. The query might look like this:</p>

<pre><code>    select id from t where t.name like &#39;%edinburgh%&#39;</code></pre>

<h3 id="Limitations">Limitations</h3>

<p>Currently, a regex in Links cannot be treated as a first-class value: a regex can only appear <i>lexically</i> as the right-hand side of a use of the <code>~</code> operator. The left-hand side may be any expression of <code>String</code> type.</p>

<p>There is presently no way to perform regex-based substitutions or to capture parts of a regex match for later use.</p>

<h1 id="Typing">Typing</h1>

<h2 id="Types-in-Links">Types in Links</h2>

<p>Links is a strongly-typed, statically-typed programming language.</p>

<p>This means that every value has a type, and every operation admits just certain types as arguments. The compiler will check that a program uses every value in a way consistent with a type. This way, for example, you can concatenate two lists but you can&#39;t concatenate two integers--it wouldn&#39;t make sense, and if you try to do it, the compiler will report an error up front. If a program passes the compiler, you can be certain that it doesn&#39;t have any type errors (modulo any bugs in the compiler!)</p>

<p>When you use Links through the interactive shell, it tells you the type of every result value. You can use this shell to get familiar with the types of various values. For example:</p>

<pre><code>    links&gt; 1 + 1;
    2 : Int

    links&gt; { var name = &quot;Gallileo&quot;; &quot;Hi, &quot; ++ name };
    &quot;Hi, Gallileo&quot; : String

    links&gt; (42, &quot;The answer&quot;);
    (42, &quot;The answer&quot;) : (Int, String)

    links&gt; [2, 4, 6, 8];
    [2, 4, 6, 8] : [Int]

    links&gt; (  price = 1.95, drinkName = &quot;Latte&quot; );
    (price=1.95,drinkName=&quot;Latte&quot;) : (drinkName:String,price:Float)

    links&gt; Red(7);
    Red(7) : [|Red:Int | a|]

    links&gt; Blue(7);
    Blue(7) : [|Blue:Int | a|]

    links&gt; [(42, &quot;The answer&quot;),
            (7, &quot;The number of wonders of the world&quot;)];
    [(42, &quot;The answer&quot;), (7, &quot;The number of wonders of the world&quot;)]
      : [(Int, String)]</code></pre>

<p>Note that the type of an integer is Int, and the type of a string is String. The <i>pair</i> <code>(42, &quot;The answer&quot;)</code> has a type that indicates the first part of the pair is an <code>Int</code> and the second part is a <code>String</code>; this type is written <code>(Int, String)</code>.</p>

<p>A list type is written with square brackets around the type of its elements. Note that <i>all elements of a list must be of the same type</i>. This allows you to apply an operation to an arbitary element of the list and to know what type it is. If you need to mix different types within a list, you can do so by assigning variant tags to each.</p>

<p>By constrast, elements of a tuple can be of the same or of different types, but the number of elements of a tuple is fixed.</p>

<p>The type of a record indicates exactly which fields should be present, and what their types are. The type of a variant tells you what its label is, and what type is contained in that label. (Note that, when you have a function, it may yield a variant type that allows more than one label. Each label has a specific type for its content.)</p>

<p>When you try to evaluate an ill-typed expression, the system will give you a type error:</p>

<pre><code>    links&gt; [2, 4, 6, 8, &quot;Who do we appreciate?&quot;];
    &lt;stdin&gt;:1: Type error: Cannot unify abstract type &#39;List&#39; with type &#39;Int&#39;
    In expression: [2, 4, 6, 8, &quot;Who do we appreciate?&quot;].</code></pre>

<h2 id="Base-types">Base types</h2>

<p>The base types offered by Links are</p>

<pre><code>  Bool  Int  Char  Float  Xml  Database</code></pre>

<p>The type <code>String</code> is not really a base type, but rather an alias for <code>[Char]</code> (the type for lists of characters). This means that any general list operation will work on a <code>String</code>.</p>

<h2 id="Type-annotations">Type annotations</h2>

<p>Links can infer type information for any program you give it. This means that you typically don&#39;t have to declare any types. But if you get a type error, it may not point to the part of the code where you really made the mistake.</p>

<p>To help the interpreter understand what you intend, and to help it pin down the error to the right place, you can give an optional type annotation on any expression. This is done using the colon as the type ascription operator, as follows:</p>

<pre><code>    2 + 2 : Int            # OK
    &quot;two plus two&quot; : Int   # ERROR</code></pre>

<p>When dealing with constants, as above, the type is always obvious. Type annotation is more useful when dealing with functions, whose type may be inferred in a way that&#39;s not obvious. Suppose for example that you have a function h that you know should always return a list of Ints. You can tell the compiler this, and it will check that it is the case:</p>

<pre><code>  fun h(x, y) {
    f(x) ++ g(y) : [Int]
  }</code></pre>

<p>This can be useful because f and g may in fact return types that are compatible (such as <code>[String]</code>), but are not what you expect. Since they are compatible, the function <code>h</code> will be type-correct; but elsewhere in the program, you may get a confusing type error involving <code>h</code>. Providing an annotation for <code>h</code>, like this, will force the compiler to tell you if <code>h</code> does not have the type you expect.</p>

<h2 id="Type-aliases">Type aliases</h2>

<p>Sometimes it is convenient to define an alias for a type in order to avoid having to write out the whole type every time it is used. For instance, suppose you want a type for representing colours:</p>

<pre><code>  [|Red | Orange | Yellow | Green | Blue | Indigo | Violet|]</code></pre>

<p>Then you can write:</p>

<pre><code>  typename Colour = [|Red | Orange | Yellow | Green | Blue | Indigo | Violet|];</code></pre>

<p>and following this declaration you can use <code>Colour</code> in place of <code>[|Red | Orange | Yellow | Green | Blue | Indigo | Violet|]</code>. For instance, you can now define functions with the following signatures:</p>

<pre><code>  sig showColour : (Colour) -&gt; String
  sig invertColour : (Colour) -&gt; Colour
  sig combineColours : (Colour, Colour) -&gt; Colour</code></pre>

<p>It is also possible to define parameterised type aliases.</p>

<pre><code>  links&gt; typename Pair(a, b) = (a, b)
  Pair = a,b.(a,b)
  links&gt; (1, true) : Pair (?, ?)
  (1, true) : Pair (Int, Bool)</code></pre>

<p>It is even possible to parameterise type aliases over row variables.</p>

<pre><code>  links&gt; typename R(r::Row) = (x:Int|r);
  R = a.(x:Int|a)
  links&gt; (x=1, y=true) : R({x:Int, y:Bool});
  (x=1,y=true) : R ({ x:Int,y:Bool })</code></pre>

<p>Curly braces indicate that an argument to a type alias is a row rather than a type.</p>

<p>Currently type aliases are only allowed at the top-level.</p>

<h2 id="Type-variables">Type variables</h2>

<p>Type variables in Links are written as lower case names.</p>

<pre><code>  sig id : (a) -&gt; a
  fun id(x) {x}</code></pre>

<p>We distinguish between <i>rigid</i> type variables and <i>flexible</i> type variables. A <i>rigid</i> type variable (like the <code>a</code> in the <code>id</code> function above) is a proper polymorphic object-level type variable that can be instantiated to any type when its binding function is applied. A <i>flexible</i> type variable (also called a <i>weak</i> type variable or <i>unification</i> type variable) is a monomorphic meta-level variable that will be instantiated to a object-level type by the type inference algorithm. A flexible type variable is indicated by prefixing a type variable with a percent sign <code>%</code>. Flexible type variables are useful if you want to assert the shape of the type of an expression, but you want type inference to fill in some of the type for you.</p>

<pre><code>  links&gt; (1, (2, ((3, fun (x) {x}), &quot;a&quot;)), true) : (Int, %a, Bool);
  (1, (2, ((3, fun), &quot;a&quot;)), true) : (Int, (Int, ((Int, (a) -&gt; a), String)), Bool)</code></pre>

<p>If you only want to use a flexible type variable once, then you don&#39;t need to name it.</p>

<pre><code>  links&gt; (1, (2, ((3, fun (x) {x}), &quot;a&quot;)), true) : (Int, %, Bool);
  (1, (2, ((3, fun), &quot;a&quot;)), true) : (Int, (Int, ((Int, (a) -&gt; a), String)), Bool</code></pre>

<p>A rigid type variable that is only used once is written as <code>_</code>. This notation is also used by the pretty-printer.</p>

<pre><code>  links&gt; fun (x) {0};
  fun : (_) -&gt; Int</code></pre>

<h2 id="Function-types-and-effects">Function types and effects</h2>

<p>Function typess in Links are annotated with effects. The primitive form of a function type is:</p>

<pre><code>  (A1, ..., An) {E}-&gt; B</code></pre>

<p>This is the type of a function that takes n arguments of types <code>A1</code>, ..., <code>An</code>, has effects <code>E</code> and returns values of type <code>B</code>.</p>

<p>The effects <code>E</code> are represented as a <i>row</i> type (as used in record and variant types). If an effect is present then that indicates that it might happen at run-time. If an effects absent then that indicates that it will definitely not happen at run-time.</p>

<p>Currently the only two effects that are tracked in Links are <code>wild</code>, which corresponds to code that cannot be run in the database, and <code>hear:A</code> which corresponds to code that can &#39;hear&#39; messages of type <code>A</code>. In the future we plan to experiment with tracking other effects.</p>

<p>In an effort to make function types more readable, syntactic sugar is provided for a number of common classes of function arrow. As well as being available to the programmer, the syntactic sugar is also used by the pretty-printer. The meta-variable <code>X</code> stands for a rigid (<code> a</code> or <code>_</code>) or flexible (<code>?a</code> or <code>?</code>) row variable.</p>

<pre><code>  -X-&gt;           {|X}-&gt;
  -&gt;             {|_}-&gt;
  {E}~&gt;          {wild,E}~&gt;
  ~X~&gt;           {|X}~&gt;
  ~&gt;             {|_}~&gt;

  {:A}~&gt;         {hear:A}~&gt;
  {:A,E}~&gt;       {hear:A,E}~&gt;
  {:A|X}~&gt;       {hear:A|X}~&gt;</code></pre>

<h2 id="Kinds-and-subkinding">Kinds and subkinding</h2>

<p>The Links type system has three <i>kinds</i> for classifying types and type variables: standard types and type variables have kind <code>Type</code>, rows and row variables have kind <code>Row</code>, and presence flags and presence variables have kind <code>Presence</code>.</p>

<p>In order to allow the type system to enforce the constraint that queries can only return lists of records of base type, Links also supports a very basic form of <i>subkinding</i>. Type variables and row variables can be annotated with a subkind. Type variables either have subkind <code>Any</code>, which means they can be instantiated to any type, or subkind <code>Base</code> which means they can only be instantiated to base types. The subkind <code>Base</code> is a subkind of <code>Any</code>. Similarly, row variables either have subkind <code>Any</code> or subkind <code>Base</code>. A row variable of subkind <code>Base</code> can only be instantiated with a row if all the field in the row are base types. Type inference introduces subkind annotations when inferring the type of a query.</p>

<pre><code>  links&gt; fun (e) {query {e}};
  fun : ([(|a::Base)]) -&gt; [(|a::Base)]</code></pre>

<p>The base types are: <code>Int</code>, <code>Bool</code>, <code>Float</code>, <code>Char</code> and <code>String</code>.</p>

<p>(In fact <code>String</code> is an alias for <code>[Char]</code>. This leads to a hole in our SQL compilation scheme, as it fails to disallow string manipulation code that cannot be compiled to SQL, such as the following:</p>

<pre><code>  fun (t) {for (r &lt;-- t) [(name=(for (c &lt;- r.name) where (c &lt;&gt; &#39;a&#39;) [c]):String)]}</code></pre>

<p>This problem will be fixed in a future version of Links by changing <code>String</code> to be a distinct base type.)</p>

<h1 id="Features">Features</h1>

<h2 id="Formlets">Formlets</h2>

<p>Links allows the <i>abstraction</i> of small fragments of an HTML form, called <i>formlets</i>, so that the submitted data can be packaged into more meaningful components, and the submitted data can be abstracted from its HTML-level representation.</p>

<p>As an example, you may wish to create a <i>formlet</i> to abstract the notion of a &quot;date entry field.&quot; Concretely, in HTML, this might take a variety of forms; it might use just one input field, or a field for each component (day, month, and year), or it might present a graphical control for the user to select a date.</p>

<p>The <i>client code</i> of the formlet wants to receive the date value in one lump, not as individual fields; furthermore the format of the data received by the client need not be the same as the format sent by the browser. As a result, the designer of the date formlet may change the HTML representation without changing the date representation that is returned to the client code. We say that the formlet is <i>abstracted</i> from the HTML representation of a form.</p>

<p>This abstraction is achieved in Links using a syntactic construct known as <code>formlet</code>/<code>yields</code>. An example date formlet might look like this:</p>

<pre><code>  fun dateFormlet(msg) {
    formlet &lt;#&gt;
      {stringToXml(msg)} &lt;br /&gt;
      Day:   {inputInt -&gt; day}
      Month: {inputInt -&gt; month}
      Year:  {inputInt -&gt; year}
    &lt;/#&gt;
    yields {
      Date(day, month, year)
    }
  }</code></pre>

<p>This function takes a string <code>msg</code> from the caller (a bit of text to include before the input fields) and constructs an XML value including three input fields with the <code>msg</code> above them. The inputs are introduced using the <i>formlet binding</i> construct, which looks like this:</p>

<pre><code>   { body -&gt; x }</code></pre>

<p>The expresion <code>body</code> (in the above example, <code>inputInt</code>) is itself a formlet; it has a concrete realization (<code>inputInt</code> is realized simply as an HTML <code>&lt;input&gt;</code> field) but will later (when the web user submits the form) produce a value, which will be bound to <code>x</code>. <code>x</code> is in scope throughout the <code>yields</code> expression.</p>

<p>The <code>yields</code> expression is where the data is packaged for the client. It is evaluated only when the form is submitted. The value emitted by the yields expression can further be bound by yet another formlet binding.</p>

<p>Thus, to continue the example, another piece of code can make use of the dateFormlet as follows:</p>

<pre><code>  formlet
    &lt;table&gt;
    &lt;tr&gt;&lt;td&gt;
      {dateFormlet(&quot;Arrival&quot;) -&gt; arrival}
    &lt;/td&gt;&lt;td&gt;
      {dateFormlet(&quot;Departure&quot;) -&gt; departure}
    &lt;/td&gt;&lt;/tr&gt;
    &lt;/table&gt;
  yields
    Itinerary(arrival, departure)</code></pre>

<p>Here the values bound to <code>arrival</code> and <code>departure</code> are the values emitted by the respective <code>yields</code> bodies of the formlets returned by calls to <code>dateFormlet</code>; in this case they will be <code>Date</code>-tagged values such as <code>Date(28, 2, 2007)</code>.</p>

<p>The type of a <code>formlet</code>/<code>yields</code> expression is <code>Formlet(</code><i>a</i><code>)</code>, where <i>a</i> is the type returned by the <code>yields</code> body. The function <code>dateFormlet</code> thus has type <code>String -&gt; Formlet([|Date:(Int, Int, Int)|])</code>.</p>

<p>A <code>Formlet(</code><i>a</i><code>)</code> value cannot be embedded in HTML until it has been &quot;rendered&quot;. To render such a value, use the render function:</p>

<pre><code>    render(formlet &lt;#&gt; {input -&gt; x} &lt;/#&gt; yields { x }, handler)</code></pre>

<p><code>render</code> has type <code>(Formlet (a), (a -&gt; XML)) -&gt; XML</code>.</p>

<p>Having <code>render</code>ed a formlet as a form, the resulting XML can be returned to the top-level, and thence served to the browser. When the user submits the form, all the submitted data will be processed by all the intermediate <code>yields</code> bodies, and finally the function <code>handler</code> will be called.</p>

<h2 id="Concurrency">Concurrency</h2>

<p>A Links program begins as a single thread of control but can fork into many processes by executing the <code>spawn</code> primitive:</p>

<pre><code>  var newProcID = spawn { expression };</code></pre>

<p>This starts a new process which begins by evaluating <code>expression</code>. The value of the expression is discarded if evaluation ever completes. <code>spawn</code> returns an identifier of the new process to the calling process. This identifier can be used to address messages to the new process, with the <code>!</code> primitive (pronounced &quot;send&quot;):</p>

<pre><code>   procId ! msg</code></pre>

<p>This appends the value <code>msg</code> to the mailbox for the process identified by <code>procID</code>. The return value is just <code>()</code>. The mailbox is FIFO, so if you know that some message is sent before some other message, you know they will be received in that order.</p>

<p>Each process&#39;s mailbox is given a static type according to the messages it expects to receive. Typically, a process will use variants to tag the various messages it can receive; for example, a process that can expects to be informed of passing comets and celebrity sightings might expect to receive either a value <code>CelebritySighting(celebName, atVenue)</code> or a value <code>PassingComet(cometID, zenith, azimuth)</code>. This process&#39;s mailbox would be given the type <code>[|CelebritySighting:(String, String) | PassingComet:(Int, Float, Float)|]</code></p>

<p>A process can receive messages using the <code>recv</code> function, which returns the next message in the current process&#39;s mailbox.</p>

<pre><code>  var nextMsg = recv()</code></pre>

<p>More commonly, however, you will want to dispatch on the received message&#39;s variant tag immediately. The <code>receive</code> construct makes this easy to do.</p>

<pre><code>  receive {
    case CelebritySighting(celebName, atVenue) -&gt; e1
    case PassingComet(cometID, zenith, azimuth) -&gt; e2
  }</code></pre>

<p>This removes the next message from the mailbox and does a <code>switch</code> on it. (See <a href="#Polymorphic-variants">&quot;Polymorphic variants&quot;</a>).</p>

<h2 id="Located-code-and-remote-procedure-calls">Located code and remote procedure calls</h2>

<p>A client-side Links program can make seamless remote procedure calls to the server, and the server can in turn make remote procedure calls to the client. The server stores no state while the computation is proceeding at the client.</p>

<p>To use this feature, simply annotate functions with the keyword &quot;client&quot; or &quot;server&quot;. For example:</p>

<pre><code>  fun lookupUserID(username) server {
    for (user &lt;- users)
    where (user.name = username)
      [user.id]
  }

  fun setPageBackground(color) client {
    doc = domGetDocumentRef();
    domSetAttributeRef(doc, &quot;style&quot;, &quot;background-color: &quot; ++ color);
  }</code></pre>

<p>A function annotated with &quot;server&quot; will always run on the server, even if it is called from code running on the client. Likewise for &quot;client&quot; functions.</p>

<p>A server call is implemented as a distinguished HTTP request. A client call is implemented as a special HTTP response body which the client-side code recognizes as a remote call.</p>

<p>Programs that neither contain client-annotated definitions nor make use of client primitives (such as the DOM functions described below) are processed differently by Links. In such cases plain HTML, not JavaScript, is sent to the browser, and all interaction takes place via standard HTML form submission.</p>

<h2 id="Handling-User-Actions">Handling User Actions</h2>

<p>A Links program usually runs on a client (browser) and a server. The client code can be notified when certain user events take place, such as pressing a key on the keyboard or clicking on a hyperlink. The code that responds to such events is associated with particular nodes in the DOM tree and is expressed through special XML attributes, called l-event attributes, attached to the relevant XHTML tags. This section defines the attributes and their use.</p>

<p>An l-event attribute begins with the prefix <code>l:</code> and corresponds to an event type as defined by the browser. The event type is determined by the attribute name simply by stripping off the <code>l:</code> prefix. Widely-supported l-event attributes include:</p>

<ul>

<li><p><code>l:onmousedown</code></p>

</li>
<li><p><code>l:onmouseup</code></p>

</li>
<li><p><code>l:onmousemove</code></p>

</li>
<li><p><code>l:onmouseout</code></p>

</li>
<li><p><code>l:onmouseenter</code></p>

</li>
<li><p><code>l:onkeyup</code></p>

</li>
<li><p><code>l:onkeydown</code></p>

</li>
<li><p><code>l:onclick</code></p>

</li>
<li><p><code>l:onfocus</code></p>

</li>
<li><p><code>l:onchange</code></p>

</li>
<li><p><code>l:onload</code></p>

</li>
</ul>

<p>When an element containing one of these attributes is installed in the current DOM document (see <a href="#Modifying-the-Web-Page">&quot;Modifying the Web Page&quot;</a>), the associated code is registered as a handler for the corresponding event type. If the element is removed from the DOM, its event handlers become inactive.</p>

<p>The content of one of these attributes should be a Links expression enclosed in curly braces, an expression of type <code>()</code> which may perform side-effects in response to the event. For example:</p>

<pre><code>    &lt;input type=&quot;button&quot; value=&quot;Add Photo&quot;
           l:onclick=&quot;{domAppendChild(container,
                                         &lt;img src=&quot;icon.jpeg&quot;/&gt;)}&quot; /&gt;</code></pre>

<h3 id="Interpreting-the-Event">Interpreting the Event</h3>

<p>In an l-event handler, there is a special variable in scope called <code>event</code>. This variable contains an object of type <code>Event</code> which can be accessed using the following API. This API corresponds to the Yahoo! Web UI library (<a href="http://developer.yahoo.com/yui/">http://developer.yahoo.com/yui/</a>). These methods are implemented in a browser-independent way. These functions constitute the sole interface to the <code>Event</code> object: the object is not a record and has no directly-accessible fields.</p>

<dl>

<dt id="getTarget"><code>getTarget</code></dt>
<dd>

<p>An event generally has a <i>target</i>, a DomNode at which the event has occurred (for example, a mouse-down event will have as its target the leaf node upon which the mouse was clicked). This method returns the target.</p>

</dd>
<dt id="getTargetElement"><code>getTargetElement</code></dt>
<dd>

<p>This function behaves like <code>getTarget</code>, except that if the node is a text node (rather than an element node), it returns the node&#39;s parent (which must be an element node).</p>

</dd>
<dt id="getFromElement"><code>getFromElement</code></dt>
<dd>

</dd>
<dt id="getToElement"><code>getToElement</code></dt>
<dd>

<p>Mouse-out and mouse-over events have two targets. The function <code>getFromElement</code> returns the element the mouse came from. <code>getToElement</code> returns the element from which the mouse came.</p>

</dd>
<dt id="getPageX"><code>getPageX</code></dt>
<dd>

</dd>
<dt id="getPageY"><code>getPageY</code></dt>
<dd>

<p>Some events refer to a particular point on the page. These methods return the x and y coordinates of that point, relative to the top-left corner of the page (<i>right</i> and <i>down</i> are the positive directions).</p>

</dd>
<dt id="getTime"><code>getTime</code></dt>
<dd>

</dd>
</dl>

<h2 id="Modifying-the-Web-Page">Modifying the Web Page</h2>

<p><a href="#XML-Quasiquotes">XML Quasiquote</a> expressions construct XML values, but these values are not rendered by a browser immediately. XML values can be used to create DOM nodes, which in turn can be installed in the <i>active document</i>.</p>

<p>There are two ways to install nodes in the active document:</p>

<dl>

<dt id="An-XML-value-returned-by-the-final-expression-of-a-Links-program-is-converted-to-a-DOM-node-and-installed-as-the-initial-active-document.-This-is-true-in-client-context-as-well-as-server-context">1. An XML value returned by the final expression of a Links program is converted to a DOM node and installed as the (initial) active document. This is true in client context as well as server context.</dt>
<dd>

</dd>
<dt id="A-set-of-primitives-beginning-with-dom--are-provided-for-making-modifications-to-particular-parts-of-the-document.-These-operations-only-work-in-client-context">2. A set of primitives (beginning with <code>dom</code>-) are provided for making modifications to particular parts of the document. These operations only work in client context.</dt>
<dd>

</dd>
</dl>

<p>Elements that are not installed are not visible, nor do events occur on them, so their event handlers cannot fire. (See <a href="#Handling-User-Actions">&quot;Handling User Actions&quot;</a>.)</p>

<p>Links makes a distinction between XML trees, which are immutable, and DOM nodes, which are mutable objects. DOM nodes are owned by a DOM manager module, and all interaction with DOM nodes is through calls to that module, using objects call <code>DomNode</code>s. You can create DOM nodes by passing an XML tree: the XML constitutes a model for the DOM node, which is a rough copy of the XML. Likewise, from a DomNode, you can extract an XML image of the DOM node and its DOM subtree. The browser may have special semantics associated with DOM nodes, and may add or remove attributes and children without warning; XML values, however, are completely within the control of the Links program.</p>

<h3 id="DOM-operations">DOM operations</h3>

<p>The operations for DOM interaction are as follows.</p>

<p>Operations ending with <code>Ref</code> work on DOM nodes; operations ending with <code>Xml</code> take an XML value and convert it to a DOM node before working with it.</p>

<dl>

<dt id="insertBefore-xml-beforeNode"><code>insertBefore(xml, beforeNode)</code></dt>
<dd>

<p>Creates a sequence of nodes using <code>xml</code> as the image, and adds them as the previous sibling of the node <code>beforeNode</code>.</p>

</dd>
<dt id="appendChildren-xml-parentNode"><code>appendChildren(xml, parentNode)</code></dt>
<dd>

<p>Creates a sequence of nodes using <code>xml</code> as the image, and adds them as the after the last child of the node <code>parentNode</code>.</p>

</dd>
<dt id="replaceNode-xml-node"><code>replaceNode(xml, node)</code></dt>
<dd>

<p>Replaces <code>node</code> with xml.</p>

</dd>
<dt id="replaceDocument-xmlVal"><code>replaceDocument(xmlVal)</code></dt>
<dd>

<p>Replaces the entire document with xmlVal.</p>

</dd>
<dt id="domInsertBeforeRef-moveRef-beforeRef"><code>domInsertBeforeRef(moveRef, beforeRef)</code></dt>
<dd>

<p>Moves the node <code>moveRef</code> to become the previous sibling of the node <code>beforeRef</code>.</p>

</dd>
<dt id="domAppendChildRef-newChildRef-parentRef"><code>domAppendChildRef(newChildRef, parentRef)</code></dt>
<dd>

<p>Moves the node <code>newChildRef</code> to become the last child of the node <code>parentRef</code>.</p>

</dd>
<dt id="removeNode-node"><code>removeNode(node)</code></dt>
<dd>

<p>Removes <code>node</code> from its current position, leaving it with no parent. This makes it an orphan.</p>

</dd>
<dt id="domReplaceChildren-xml-node"><code>domReplaceChildren(xml, node)</code></dt>
<dd>

<p>Replaces the children of <code>node</code> with xml.</p>

</dd>
<dt id="swapNodes-node1-node2"><code>swapNodes(node1, node2)</code></dt>
<dd>

<p>Swap node1 with node2.</p>

</dd>
<dt id="getDocumentNode"><code>getDocumentNode()</code></dt>
<dd>

<p>Return a reference to the <i>document element</i>, that is, the top-level of the installed document.</p>

</dd>
<dt id="getNodeById-id"><code>getNodeById(id)</code></dt>
<dd>

<p>Given a string ID value, finds the DOM node with that ID and returns it. If more than one node has that ID, the behavior is undefined.</p>

</dd>
<dt id="getValue-node"><code>getValue(node)</code></dt>
<dd>

<p>Translates the given DOM node into an XML value and returns that.</p>

</dd>
<dt id="isNull-node"><code>isNull(node)</code></dt>
<dd>

<p>Returns true if <code>node</code> is null.</p>

</dd>
<dt id="isElementNode-node"><code>isElementNode(node)</code></dt>
<dd>

<p>Returns true if <code>node</code> is not null and is an element node.</p>

</dd>
</dl>

<p>Note: when manipulating the DOM, care should be taken to ensure that a given ID value appears only once amongst the installed DOM nodes. Some operations may behave unreliably when IDs are duplicated. Orphaned DOM nodes may reuse ID values.</p>

<p>You can also access attributes of DOM nodes, and navigate the DOM tree, in a read-only fashion using the following operations:</p>

<dl>

<dt id="domGetTagNameFromRef-ref">domGetTagNameFromRef(ref)</dt>
<dd>

<p>Returns the tag name of <code>ref</code> as a string. For example, a <code>div</code> node would return the string <code>&quot;div&quot;</code>.</p>

</dd>
<dt id="domGetAttributeFromRef-ref-attrName"><code>domGetAttributeFromRef(ref, attrName)</code></dt>
<dd>

<p>Returns the value of the attribute <code>attrName</code> on the node <code>ref</code>. For example, on a node pointed to by <code>ref</code> with the XML representation</p>

<pre><code>  &lt;a href=&quot;more_info.html&quot;&gt;More info&lt;/a&gt;,</code></pre>

<p>the call <code>domGetAttributeFromRef(ref, &quot;href&quot;)</code> would return the string <code>&quot;more_info.html&quot;</code>.</p>

</dd>
<dt id="domGetParentFromRef-ref">domGetParentFromRef(ref)</dt>
<dd>

<p>If the node pointed to by <code>ref</code> has a parent, this call returns a reference to that parent node.</p>

</dd>
<dt id="domGetFirstChildFromRef-ref">domGetFirstChildFromRef(ref)</dt>
<dd>

<p>If the node pointed to by <code>ref</code> has children, this call returns a reference to the first child (in document order).</p>

</dd>
<dt id="domGetNextSibingFromRef-ref">domGetNextSibingFromRef(ref)</dt>
<dd>

<p>If the node pointed to by <code>ref</code> has siblings occurring after it, this call returns a reference to the next sibling.</p>

</dd>
<dt id="domGetChildrenFromRef-ref">domGetChildrenFromRef(ref)</dt>
<dd>

<p>Returns a list of references to the child nodes of the node ref. NOT YET IMPLEMENTED</p>

</dd>
<dt id="getInputValue-id">getInputValue(id)</dt>
<dd>

<p>Gets the current value of an input element with identity <code>id</code>.</p>

</dd>
</dl>

<h2 id="XML-operations">XML operations</h2>

<p>For inspecting pure XML values, the following functions are provided:</p>

<dl>

<dt id="getTagName-xml">getTagName(xml)</dt>
<dd>

<p>Returns the tag name of the given XML node, as a string. For example:</p>

<pre><code>    getTagName(&lt;h1&gt;Dog Bites Man&lt;/h1&gt;)</code></pre>

<p>returns the string <code>&quot;h1&quot;</code>. It is an error to apply this to an XML text node.</p>

</dd>
<dt id="getTextContent-xml">getTextContent(xml)</dt>
<dd>

<p>Given an XML text node <code>xml</code>, returns the text as a string. It is an error to apply this to an element node.</p>

</dd>
<dt id="getAttributes-xml">getAttributes(xml)</dt>
<dd>

<p>Fetches a list the list of attributes associated with the given XML value.</p>

<pre><code>    getAttributes(&lt;div class=&quot;sidebar&quot; /&gt;)</code></pre>

<p>returns <code>[(&quot;class&quot;, &quot;sidebar&quot;)]</code>. It is an error to apply this to an XML text node.</p>

</dd>
<dt id="hasAttribute-xml-attrName">hasAttribute(xml,attrName)</dt>
<dd>

<p>Returns true if the given XML value has the named attribute and false otherwise. For example</p>

<pre><code>    hasAttribute(&lt;div class=&quot;sidebar&quot; /&gt;, &quot;class&quot;)</code></pre>

<p>returns <code>true</code>. It is an error to apply this to an XML text node.</p>

</dd>
<dt id="getAttribute-xml-attrName">getAttribute(xml,attrName)</dt>
<dd>

<p>Fetches the named attribute of the given XML value, as a string. For example</p>

<pre><code>    getAttribute(&lt;div class=&quot;sidebar&quot; /&gt;, &quot;class&quot;)</code></pre>

<p>returns <code>&quot;sidebar&quot;</code>. It is an error to apply this to an XML text node.</p>

</dd>
<dt id="getChildNodes-xml">getChildNodes(xml)</dt>
<dd>

<p>Returns a list of the child nodes of this xml node.</p>

</dd>
</dl>

<h2 id="Cookies">Cookies</h2>

<p>When in the context of an HTTP request, cookies can be manipulated using these library functions:</p>

<pre><code>    getCookie : (String) ~&gt; String
    setCookie : (String, String) ~&gt; unit</code></pre>

<p>Each takes the cookie name as its first parameter. <code>getCookie</code> returns the current value of the cookie, as it was passed with the HTTP request. <code>setCookie</code> takes, as its second parameter, the new value for that cookie. There is currently no way to control the path/domain restrictions of the cookie or the expiration date. All cookies set by these utilities are session cookies and expire when the browser is closed. More flexible support for cookies is planned for future work.</p>

<h1 id="Library-functions">Library functions</h1>

<p>Links has various built-in library functions. A full list of these, along with their types, can be obtained by typing <code>@builtins;</code> in the interactive shell.</p>

<h2 id="Explicit-type-conversions">Explicit type conversions</h2>

<pre><code> stringToInt      : (String) -&gt; Int
 intToFloat       : (Int) -&gt; Float
 intToString      : (Int) -&gt; String
 floatToString    : (Float) -&gt; String
 stringToXml      : (String) ~&gt; Xml
 intToXml         : (Int) ~&gt; Xml
 floatToXml       : (Int) ~&gt; Xml</code></pre>

<p>These function convert between values of different types.</p>

<pre><code> ord              : (Char) -&gt; Int
 chr              : (Int) -&gt; Char</code></pre>

<p>The <code>ord</code> and <code>chr</code> functions converts between a character and its ASCII value as an integer.</p>

<h2 id="Negation">Negation</h2>

<pre><code> not              : (Bool) -&gt; Bool
 negate           : (Int) -&gt; Int
 negatef          : (Float) -&gt; Float</code></pre>

<h2 id="Character-classification">Character classification</h2>

<pre><code> isAlpha          : (Char) ~&gt; Bool
 isAlnum          : (Char) ~&gt; Bool
 isLower          : (Char) ~&gt; Bool
 isUpper          : (Char) ~&gt; Bool
 isDigit          : (Char) ~&gt; Bool
 isXDigit         : (Char) ~&gt; Bool
 isBlank          : (Char) ~&gt; Bool</code></pre>

<p>(<code>isXDigit</code> returns true for hexadecimal digits)</p>

<h2 id="Case-conversion">Case conversion</h2>

<pre><code> toUpper          : (Char) -&gt; Char
 toLower          : (Char) -&gt; Char</code></pre>

<h2 id="Floating-point-functions">Floating point functions</h2>

<pre><code> floor            : (Float) -&gt; Float
 ceiling          : (Float) -&gt; Float
 cos              : (Float) -&gt; Float
 sin              : (Float) -&gt; Float
 tan              : (Float) -&gt; Float
 log              : (Float) -&gt; Float
 sqrt             : (Float) -&gt; Float</code></pre>

<h2 id="Miscellaneous">Miscellaneous</h2>

<pre><code> print            : (String) ~&gt; ()</code></pre>

<p>Print a string to the standard output. (This function has undefined behaviour when Links is running as a CGI script.)</p>

<pre><code> error            : (String) ~&gt; a
 </code></pre>

<p>Raise a fatal error.</p>

<pre><code> debug            : (String) ~&gt; ()</code></pre>

<p>Output a string to stderr. When running a client function this will output to a special window only if links is run with the -d flag. When running a server function stderr is typically forwarded to the web server&#39;s error log.</p>

<pre><code> sleep            : (Int) ~&gt; ()</code></pre>

<p>Wait for the specified number of seconds.</p>

<pre><code> exit             : (a) ~&gt; b</code></pre>

<p>Exits the program, using the argument to exit as the program&#39;s return value.</p>

<p>(FIXME: this can be ill-typed.)</p>

<pre><code> serverTime             : () ~&gt; Int
 serverTimeMilliseconds : () ~&gt; Int
 clientTime             : () ~&gt; Int
 clientTimeMilliseconds : () ~&gt; Int</code></pre>

<p>Get the time on the server (resp. client) in seconds or milliseconds since January 1, 1970.</p>

<h1 id="Standard-library-prelude">Standard library (prelude)</h1>

<p>A set of standard Links functions is defined in the file <code>prelude.links</code>. This file is loaded automatically whenever Links runs a program. The functions it defines are explained below.</p>

<h2 id="List-utilities">List utilities</h2>

<ul>

<li><p>length : ([_]) ~&gt; Int</p>

<p>Returns the number of elements in the given list.</p>

</li>
<li><p>all : (a b~&gt; Bool, [a]) b~&gt; Bool</p>

<p>Returns <code>true</code> if all elements of the list satisfy the predicate, <code>false</code> otherwise. (All elements of the empty list satisfy any predicate).</p>

</li>
<li><p>and : ([Bool]) ~&gt; Bool</p>

<p>Returns <code>true</code> if all elements of the list are <code>true</code>.</p>

</li>
<li><p>any : ((a) b~&gt; Bool, [a]) b~&gt; Bool</p>

<p>Returns <code>true</code> if any element of the list satisfies the predicate, <code>false</code> otherwise. (No element of the empty list satisfies any predicate).</p>

</li>
<li><p>or : ([Bool]) ~&gt; Bool</p>

<p>Returns <code>true</code> if any element of the list is <code>true</code>.</p>

</li>
<li><p>odd : (Int) -&gt; Bool even : (Int) -&gt; Bool</p>

<p>Returns <code>true</code> if the argument is, respectively, odd or even.</p>

</li>
<li><p>selectElem : ([a], Int) ~&gt; a</p>

<p><code>selectElem(list, i)</code> returns the <code>i</code>th element of the list, the first element being 0 (and throws an error if the list has fewer than <code>i</code>+1 elements).</p>

</li>
<li><p>swap : ([a], a, a) -&gt; [a]</p>

<p><code>swap(xs, a, b)</code> takes each instance of <code>a</code> in <code>xs</code> and replaces it with <code>b</code>, and vice-versa, performing the two substitutions simultaneously.</p>

<p>=item* fold_left : ((a, b) c~&gt; a, a, [b]) c~&gt; a</p>

</li>
<li><p>fold_right : ((a, b) c~&gt; b, b, [a]) c~&gt; b</p>

</li>
<li><p>fold_left1 : ((a, a) b~&gt; a, [a]) b~&gt; a</p>

</li>
<li><p>fold_right1 : ((a, a) b~&gt; a, [a]) b~&gt; a</p>

<p>The fold functions support arbitrary manipulation on lists in an &quot;algebraic&quot; way. In general, the caller gives a &quot;combining&quot; operation, an initial value, and a list. The fold combines each element of the list successively with the initial value to produce eventually a final value, which is the result of the fold. TBD</p>

<p>The expression <code>fold_left(f, init, list)</code> applies <code>f</code> successively to: the value <code>init</code> and the first element of the list, the result of that application and the second element of the list, the result of that next application and the third element of the list, and so on.</p>

<p>For example,</p>

<pre><code>   C&lt;fold_left(f, init, [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;])&gt;</code></pre>

<p>is equal to</p>

<pre><code>   C&lt;f(f(f(f(init, &#39;a&#39;), &#39;b&#39;), &#39;c&#39;), &#39;d&#39;)&gt;</code></pre>

<p>The <code>fold_right</code> function is similar but begins by applying <code>f</code> to the <i>last</i> element and <code>init</code>:</p>

<pre><code>   C&lt;fold_right(f, init, [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;])&gt;</code></pre>

<p>is equal to</p>

<pre><code>   C&lt;f(&#39;a&#39;,f(&#39;b&#39;,f(&#39;c&#39;,f(&#39;d&#39;, init))))&gt;</code></pre>

<p>You can think of a fold as traversing a list with an &quot;accumulator&quot; whose value begins with the <code>init</code> value and is updated to the value produced by <code>f</code> working on the accumulator and the next element of the list as we traverse the input list.</p>

<p>The <code>fold_left1</code> (resp. <code>fold_right1</code>) function behaves like its counterpart but uses the first (resp. last) element of the list as the initial value. This requires that the list be nonempty and the type of the initial value, result, and elements all be the same.</p>

</li>
<li><p>unzip : ([(a, b)]) -&gt; ([a], [b])</p>

<p>Split apart a list of paired elements into two parallel lists.</p>

</li>
<li><p>zip : ([a], [b]) -&gt; ([(a, b)])</p>

<p>Given two parallel lists, combine them into a single list of pairs, pairing the <i>i</i>the element of the first list with the <i>i</i>th element of the second list.</p>

</li>
<li><p>replicate : (Int, a) ~&gt; [a]</p>

<p><code>replicate(n, item)</code> returns a list containing just <code>n</code> copies of <code>item</code>.</p>

</li>
<li><p>filter : (a b-&gt; Bool, [a]) b-&gt; [a]</p>

<p>Returns just those elements from the list that satisfy the given predicate.</p>

</li>
<li><p>compose : ((a) b-&gt; c, (d) b-&gt; a) -&gt; (d) b-&gt; c</p>

<p>Given a function <code>f</code> and a function <code>g</code>, returns a function that applies <code>g</code> to its argument and <code>f</code> to the result of that.</p>

</li>
<li><p>id : (a) -&gt; a</p>

<p>Returns its argument.</p>

</li>
<li><p>map : ((a) b-&gt; c, [a]) b-&gt; [c]</p>

<p>Transforms a list by applying the function to each element of the list.</p>

<p>More precisely, it returns a list whose <i>i</i>th element is the result of applying the given function to the <i>i</i>th element of the given list.</p>

</li>
<li><p>concatMap : (a b-&gt; [c], [a]) b-&gt; [c]</p>

<p>Applies the function to each element of the list, and concatenates the resulting lists, thus returning a &quot;flat&quot; list. Works much like a <code>for</code> loop in Links.</p>

</li>
<li><p>first, second, third, fourth, fifth, sixth, sevent, eighth, ninth, tenth</p>

<p>These functions each take a tuple of any (sufficiently large) size and return the first, second, etc. element of that tuple. For example:</p>

<pre><code>    links&gt; third(4, 5, 6, 7, 8, 9)
    6</code></pre>

<p>An attempt to apply one of these functions to a tuple that doesn&#39;t have enough elements will result in a type error.</p>

</li>
<li><p>sum : ([Int]) ~&gt; Int</p>

<p>Returns the numerical sum of a list of integers.</p>

</li>
<li><p>product : ([Int]) ~&gt; Int</p>

<p>Returns the numerical produce of a list of integers.</p>

</li>
<li><p>reverse : ([a]) ~&gt; [a]</p>

<p><code>reverse(list)</code> returns a list of the elements in <code>list</code>, but in the reverse order.</p>

</li>
<li><p>concat : ([[a]]) ~&gt; [a]</p>

<p>Given a list of lists, this concatenates all of those lists together. E.g.:</p>

<pre><code>    links&gt; concat([1], [2, 3, 4], [], [5, 6])
    [1, 2, 3, 4, 5, 6]</code></pre>

</li>
<li><p>join : ([a], [[a]]) ~&gt; [a]</p>

<p><code>join(glue, list)</code> returns a list formed by interspersing the &quot;glue&quot; in between each element of <code>list</code> and concatenating them. E.g.:</p>

<pre><code>    links&gt; join(&quot;/&quot;, [&quot;milk&quot;, &quot;butter&quot;, &quot;eggs&quot;, &quot;bread&quot;])
    &quot;milk/butter/eggs/bread&quot;</code></pre>

<p>(Note the use of an ordinary <code>String</code> as a list of <code>Char</code>s.)</p>

</li>
<li><p>takeWhile : ((a) b-&gt; Bool, [a]) b-&gt; [a]</p>

<p>Returns the initial segment of the given list which satisfies the given predicate.</p>

</li>
<li><p>dropWhile : ((a) -&gt; Bool, [a]) b-&gt; [a]</p>

<p>Returns all of the given list <i>but</i> the initial segment satisfying the given predicate. <code>takeWhile(p,l) ++ dropWhile(p,l)</code> is equal to <code>l</code> for any predicate <code>p</code>.</p>

</li>
<li><p>ignore : (_) -&gt; ()</p>

<p>Throws away its argument and returns unit, the empty tuple <code>()</code>.</p>

</li>
<li><p>isJust : Maybe (_) -&gt; Bool</p>

<p>Returns <code>true</code> if its argument is <code>Just </code><i>x</i> for some <i>x</i>, that is, if it is not <code>Nothing</code>.</p>

</li>
<li><p>search : ((a) b~&gt; Bool, [a]) b~&gt; Maybe (a)</p>

</li>
<li><p>find : ((a) b~&gt; Bool, [a]) b~&gt; a</p>

</li>
<li><p>fromJust : Maybe (a) ~&gt; a</p>

<p>Given an argument <code>Just </code><i>x</i>, returns <i>x</i>. Otherwise, raises an error.</p>

</li>
<li><p>memassoc : (a,[(a, _)]) ~&gt; Bool</p>

<p>Given a key and an association list, returns <code>true</code> if the key is in the domain of the association list.</p>

</li>
<li><p>lookup : (a, [(a, b)]) ~&gt; Maybe (b)</p>

</li>
<li><p>assoc : (String, [(String, b)]) ~&gt; b</p>

</li>
<li><p>assocAll : (String, [(String, b)]) ~&gt; [b]</p>

</li>
<li><p>sortBy : ((a) b-&gt; c, [a]) b-&gt; [a]</p>

</li>
</ul>

<h2 id="Web-related-features">Web-related features</h2>

<p>These functions only make sense in the context of web programs.</p>

<ul>

<li><p>freshResource : () ~&gt; ()</p>

<p>Redirects the client to a new page and continues from the call-point.</p>

<p>The effect is that, after a call to <code>freshResource</code>, if the user hits reload in the browser, she will only cause the program to re-execute code from the call to freshResource onward.</p>

<p>This can be used after doing a destructive action (such as updating the database) which should not be automatically repeated on a subsequent reload.</p>

<p>Currently only works for server-only Links programs.</p>

</li>
<li><p>sendSuspend : (((a) -&gt; Page) d~&gt; Page) d~&gt; a</p>

<p><code>sendSuspend(f)</code> calls the function <code>f</code> to generate an page and exits the program using that page as the output.</p>

<p><code>sendSuspend</code> captures the current continuation when it is called and passes this as the argument to <code>f</code>. Thus, <code>f</code> can use its argument to resume computation at the point where <code>sendSuspend</code> was called.</p>

<p>See <code>examples/login-flow.links</code> for an example of the use of <code>sendSuspend</code>.</p>

</li>
</ul>

<h2 id="Formlet-library">Formlet library</h2>

<p>These routines can be used with the <code>formlet</code>/<code>yields</code> syntax described in <a href="#Formlets">&quot;Formlets&quot;</a>. Familiarize yourself with that mechanism before trying to read about these functions.</p>

<ul>

<li><p>xml : (Xml) -&gt; Formlet (())</p>

<p>Given some XML, returns the formlet which displays that XML and yields the unit value.</p>

</li>
<li><p>text : String -&gt; Formlet (())</p>

<p>Given a string, makes an XML text node out of it, and returns the formlet which displays that XML and yields the unit value.</p>

</li>
<li><p>plug : (XmlContext, Formlet (a)) -&gt; Formlet (a)</p>

<p>Transforms the visible (XML) part of a formlet by applying the given XML function.</p>

</li>
<li><p>input : Formlet (String)</p>

<p>Constructs a formlet containing just a simple <code>input</code> field, yielding the value entered as a <code>String</code>.</p>

</li>
<li><p>inputValue : (String) ~&gt; Formlet (String)</p>

<p>Constructs a formlet containing just a simple <code>inpute</code> field; its initial text contents are given by the argument.</p>

</li>
<li><p>inputFile : Formlet (String)</p>

<p>Constructs a formlet containing a simple <code>input</code> field of file-upload type.</p>

</li>
<li><p>inputInt : Formlet(Int)</p>

<p>Constructs a formlet containing a simple inut field whose submission will be treated as an <code>Int</code>.</p>

</li>
<li><p>inputIntValue : (Int) ~&gt; Formlet(Int)</p>

<p>Constructs a formlet containing a simple input field whose submission will be treated as an <code>Int</code> and whose default value is given in the argument.</p>

</li>
<li><p>inputFloat : Formlet(Float)</p>

<p>Constructs a formlet containing a simple input field whose submission will be treated as a <code>Float</code>.</p>

</li>
<li><p>textarea : (String) ~&gt; Formlet (String)</p>

<p>Constructs a formlet containing a simple textarea (multi-line text input) field whose contents default to the argument.</p>

</li>
<li><p>submitButton : (String) ~&gt; Formlet (Bool)</p>

</li>
<li><p>resetButton : (String) ~&gt; Formlet (Bool)</p>

</li>
<li><p>pushButton : (String) ~&gt; Formlet (Bool)</p>

</li>
<li><p>button : (String, [|Submit|Reset|Button|]) ~&gt; Formlet (Bool)</p>

<p><code>button(&quot;Text&quot;, behavior)</code> constructs a simple button element that will yield <code>true</code> if this button is the one that submits the form and <code>false</code> otherwise. <code>behavior</code> choose whether the button is an HTML submit button, a reset button, or an undistinguished button (see the HTML spec).</p>

<p>The other forms are shortcuts for corresponding choices of <code>behavior</code>.</p>

</li>
<li><p>checkbox : Formlet (Bool)</p>

<p>Constructs a formlet containing a simple checkbox field; yields <code>true</code> if the checkbox is checked at submit time, and <code>false</code> if not.</p>

</li>
<li><p>checkboxDefault : (Bool) ~&gt; Formlet (Bool)</p>

<p>Similar to <code>checkbox</code>, but allows setting the initial value (checked or unchecked).</p>

</li>
<li><p>inputRadiogroup : ([a], a, ([(Xml, a)]) {}~&gt; Xml) -&gt; Formlet (a)</p>

<p>Constructs a formlet composed of a set of radio buttons, only one of which can be selected at a time--a <i>radio group</i>.</p>

<p>The first argument gives a list of items identified simply by their keys.</p>

<p>The second argument chooses the initially selected button by its key.</p>

<p>The third argument is a &quot;layout&quot; function. To this is passed a list of the keys paired up with the HTML representations of the corresponding buttons. The layout function should return some HTML which uses all of these buttons, each precisely once. It could for example associate each button with some text, or arrange them in some sort of table pattern. The HTML of the formlet will consist of the HTML returned by the layout function.</p>

</li>
<li><p>choice : ([(a, String)]) ~&gt; Formlet (a)</p>

<p>Constructs a formlet that contains a pop-up menu (<code>select</code> element) whose options are given by the list. The argument is a list of pairs, whose second element is the human-readable text of the option, and whose first element is the unique key that will be used to identify the choice on submission. The value yielded by the formlet will be one of these keys.</p>

</li>
<li><p>choiceDefault : ([(a,String)], a) ~&gt; Formlet (a)</p>

<p>Like <code>choice</code>, this constructs a formlet containing a pop-up menu (<code>select</code> element). The second parameter is the key of a choice that should be selected by default.</p>

<p>(FIXME: This function currently doesn&#39;t work.)</p>

</li>
<li><p>choices : ([(a, String, Bool)]) ~&gt; Formlet ([a])</p>

<p>Constructs a formlet containing a multi-select scrollbox containing the options listed in the argument, as per <code>choice</code> above.</p>

</li>
</ul>

<h1 id="Running-links">Running links</h1>

<p>Links can be run either as a CGI script through a web server such as Apache, as a stand-alone Web application server, or from the command line.</p>

<p>[TODO: Document AppServer usage]</p>

<p>When run as a CGI script Links must be passed a filename as an argument:</p>

<pre><code>  links filename</code></pre>

<p>The source code to evaluate can be specified in several ways:</p>

<pre><code>  links                # run interactively
  links -e exp         # evaluate exp, print its result
  links filename       # run filename</code></pre>

<p>Command line flags can be used to enable/disable some features:</p>

<pre><code>  -O                   enable optimisation
  -n                   don&#39;t print types
  -d                   debug mode (for hacking on links itself)</code></pre>

<p>A configuration file can be chosen using this command-line option:</p>

<pre><code>  --config=&lt;filename&gt;  set a configuration file</code></pre>

<p>These other options can be fun, too:</p>

<pre><code>  --pp=&lt;command&gt;          run all input through UNIX &lt;command&gt; before parsing
  --precompile=&lt;filename&gt; precompile and store a cached version of &lt;filename&gt;
  --dump=&lt;filename&gt;       find and print out the cached version of &lt;filename&gt;</code></pre>

<h2 id="The-interactive-shell">The interactive shell</h2>

<p>The interactive shell allows server-side code to be entered dynamically. In order to evaluate an expression it must be terminated with a semi-colon followed by a new line:</p>

<pre><code>  ./links
  links&gt; 1+2;
  3 : Int
  links&gt;</code></pre>

<p>The interpreter outputs the resulting value and its type.</p>

<h3 id="Directives">Directives</h3>

<p>The interpreter supports a number of directives. Typing one of these at the interactive loop has an immediate effect.</p>

<dl>

<dt id="directives"><code>@directives</code></dt>
<dd>

<p>list available directives</p>

</dd>
<dt id="settings"><code>@settings</code></dt>
<dd>

<p>print available settings (see <a href="#Configuration-settings">&quot;Configuration settings&quot;</a>)</p>

</dd>
<dt id="set"><code>@set</code></dt>
<dd>

<p>change the value of a setting (see <a href="#Configuration-settings">&quot;Configuration settings&quot;</a>)</p>

</dd>
<dt id="builtins"><code>@builtins</code></dt>
<dd>

<p>list builtin functions and values</p>

</dd>
<dt id="quit"><code>@quit</code></dt>
<dd>

<p>exit the interpreter</p>

</dd>
<dt id="typeenv"><code>@typeenv</code></dt>
<dd>

<p>display the current type environment</p>

</dd>
<dt id="env"><code>@env</code></dt>
<dd>

<p>display the current value environment</p>

</dd>
<dt id="load"><code>@load</code></dt>
<dd>

<p>load in a Links source file, replacing the current environment</p>

</dd>
<dt id="withtype"><code>@withtype</code></dt>
<dd>

<p>search for functions that match the given type</p>

</dd>
</dl>

<h2 id="Configuration-settings">Configuration settings</h2>

<p>Links offers a number of settings which can affect the behavior of the interactive loop or the web interface.</p>

<p>The available settings can be discovered in the interactive loop using the <code>@settings</code> directive:</p>

<pre><code>    links&gt; @settings;

    User settings
     show_unification          false
     show_typechecking         false
    ...</code></pre>

<p>A setting can be modified during an interactive session using the <code>@set</code> directive:</p>

<pre><code>    links&gt; @set show_typechecking true;</code></pre>

<p>Settings can also be configured using a configuration file. To select a configuration file, use the command-line option <code>--config</code>:</p>

<pre><code>    $ links --config=&lt;filename&gt;</code></pre>

<p>A configuration file is just a set of lines, each of which contains a setting formatted as <i>&lt;setting-name&gt;</i><code>=</code><i>&lt;setting-value&gt;</i>. For example:</p>

<pre><code>    debug=on
    database_driver=postgresql</code></pre>

<p>This is particularly useful for configuring settings for a web application, where directives cannot otherwise be given.</p>


</body>

</html>
